local whitelistedUsers = {
    "Mrbignewcoming3",
    "Hi_dorihi"
}

local function isWhitelisted(username)
    for _, whitelisted in ipairs(whitelistedUsers) do
        if username == whitelisted then
            return true
        end
    end
    return false
end

local player = game.Players.LocalPlayer
if not isWhitelisted(player.Name) then
    player:Kick("Not WhiteListed L")
    return
end

local library = loadstring(game:HttpGet("https://raw.githubusercontent.com/Marwanleprodu91670/muscle-legend-lite-hub-elerium-library-/refs/heads/main/library", true))()
local window = library:AddWindow("Nova Hub V1 Paid Version | Encrypted Script", {
    main_color = Color3.fromRGB(75, 0, 130),
    min_size = Vector2.new(700, 640),
    can_resize = false
})

local Killing = window:AddTab("Killing")
Killing:AddLabel("Whitelisting")

_G.whitelist = {}
Killing:AddTextBox("Whitelist", function(name)
    if name and name ~= "" then
        _G.whitelist[name] = true
    end
end)

Killing:AddTextBox("Unwhitelist", function(name)
    if name and _G.whitelist[name] then
        _G.whitelist[name] = nil
    end
end)

Killing:AddLabel("Killing Features")

-- Auto Kill Toggle
_G.autoKill = false
Killing:AddSwitch("Auto Kill", function(state)
    _G.autoKill = state
    if state then
        task.spawn(function()
            while _G.autoKill do
                for _, targetPlayer in pairs(game.Players:GetPlayers()) do
                    if targetPlayer ~= player and not _G.whitelist[targetPlayer.Name] then
                        local targetCharacter = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
                        if targetCharacter and targetCharacter:FindFirstChild("HumanoidRootPart") then
                            if not targetCharacter:FindFirstChild("HasBeenTouched") then
                                -- Fire touch interest only once per player
                                local tag = Instance.new("BoolValue")
                                tag.Name = "HasBeenTouched"
                                tag.Parent = targetCharacter

                                firetouchinterest(player.Character.RightHand, targetCharacter.HumanoidRootPart, 1)
                                firetouchinterest(player.Character.LeftHand, targetCharacter.HumanoidRootPart, 1)
                                task.wait(0.5)
                                firetouchinterest(player.Character.RightHand, targetCharacter.HumanoidRootPart, 0)
                                firetouchinterest(player.Character.LeftHand, targetCharacter.HumanoidRootPart, 0)
                            end
                        end
                    end
                end
                task.wait(0.5)
            end
        end)
    end
end)

-- Targeting
local selectedTargetName = nil
local dropdown = Killing:AddDropdown("Select Target", function(playerName)
    selectedTargetName = playerName
end)

for _, p in ipairs(game.Players:GetPlayers()) do
    if p.Name ~= player.Name then
        dropdown:Add(p.Name)
    end
end

-- Kill Target Toggle
_G.killTargetActive = false
Killing:AddSwitch("Kill Target", function(state)
    _G.killTargetActive = state
    if state then
        task.spawn(function()
            while _G.killTargetActive do
                local targetPlayer = game.Players:FindFirstChild(selectedTargetName)
                if targetPlayer then
                    local targetCharacter = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
                    if targetCharacter and targetCharacter:FindFirstChild("HumanoidRootPart") then
                        if not targetCharacter:FindFirstChild("HasBeenTouched") then
                            -- Fire touch interest only once for selected target
                            local tag = Instance.new("BoolValue")
                            tag.Name = "HasBeenTouched"
                            tag.Parent = targetCharacter

                            firetouchinterest(player.Character.RightHand, targetCharacter.HumanoidRootPart, 1)
                            firetouchinterest(player.Character.LeftHand, targetCharacter.HumanoidRootPart, 1)
                            task.wait(0.5)
                            firetouchinterest(player.Character.RightHand, targetCharacter.HumanoidRootPart, 0)
                            firetouchinterest(player.Character.LeftHand, targetCharacter.HumanoidRootPart, 0)
                        end
                    end
                end
                task.wait(0.5)
            end
        end)
    end
end)

-- Monitor respawns and reset HasBeenTouched tag
game.Players.PlayerAdded:Connect(function(player)
    player.CharacterAdded:Connect(function(character)
        -- Reset the HasBeenTouched tag on respawn
        if character:FindFirstChild("HasBeenTouched") then
            character:FindFirstChild("HasBeenTouched"):Destroy()
        end
    end)
end)

-- Auto Punch [No Animation] Toggle
_G.autoPunchAnim = false
Killing:AddSwitch("Auto Punch [No Animation]", function(state)
    _G.autoPunchAnim = state
    if state then
        task.spawn(function()
            while _G.autoPunchAnim do
                local punchTool =
                    player.Backpack:FindFirstChild("Punch") or
                    game.Workspace:FindFirstChild(player.Name):FindFirstChild("Punch")
                if punchTool then
                    if punchTool.Parent ~= game.Workspace:FindFirstChild(player.Name) then
                        punchTool.Parent = game.Workspace:FindFirstChild(player.Name)
                    end
                    game.Players.LocalPlayer.muscleEvent:FireServer("punch", "rightHand")
                    game.Players.LocalPlayer.muscleEvent:FireServer("punch", "leftHand")
                    task.wait(0.5)
                else
                    _G.autoPunchAnim = false
                end
            end
        end)
    else
        _G.autoPunchAnim = false
    end
end)

-- Auto Equip Punch Toggle
_G.AutoEquipPunch = false
Killing:AddSwitch("Auto Equip Punch", function(state)
    _G.AutoEquipPunch = state
    if state then
        task.spawn(function()
            while _G.AutoEquipPunch do
                local punchTool = player.Backpack:FindFirstChild("Punch")
                if punchTool then
                    punchTool.Parent = player.Character
                end
                task.wait(0.5)
            end
        end)
    end
end)

-- Player Tab for Spying and Teleporting
local PlayerTab = window:AddTab("Player")
PlayerTab:AddLabel("Spying")

local selectedSpyTarget = nil
local spyDropdown = PlayerTab:AddDropdown("Select Player", function(playerName)
    selectedSpyTarget = playerName
end)

for _, p in ipairs(game.Players:GetPlayers()) do
    if p.Name ~= player.Name then
        spyDropdown:Add(p.Name)
    end
end

_G.spyActive = false
local function updateCamera(targetPlayer)
    local camera = game.Workspace.CurrentCamera
    while _G.spyActive and targetPlayer do
        local targetCharacter = targetPlayer.Character or targetPlayer.CharacterAdded:Wait()
        local humanoidRootPart = targetCharacter:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            camera.CameraSubject = humanoidRootPart
        end
        task.wait(0.5)
    end
    camera.CameraSubject = player.Character:FindFirstChild("Humanoid")
end

PlayerTab:AddSwitch("Spy Player", function(state)
    _G.spyActive = state
    if state and selectedSpyTarget then
        local targetPlayer = game.Players:FindFirstChild(selectedSpyTarget)
        if targetPlayer then
            task.spawn(updateCamera, targetPlayer)
        end
    else
        game.Workspace.CurrentCamera.CameraSubject = player.Character:FindFirstChild("Humanoid")
    end
end)

PlayerTab:AddButton("Teleport to player", function()
    if selectedSpyTarget then
        local targetPlayer = game.Players:FindFirstChild(selectedSpyTarget)
        if targetPlayer and targetPlayer.Character then
            local targetHumanoidRootPart = targetPlayer.Character:FindFirstChild("HumanoidRootPart")
            if targetHumanoidRootPart then
                player.Character:SetPrimaryPartCFrame(targetHumanoidRootPart.CFrame)
            end
        end
    end
end)
