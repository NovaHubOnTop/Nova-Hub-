local NovaHub = loadstring(game:HttpGet("https://pastebin.com/raw/Rne8BmfA"))()
local SaveManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/SaveManager.lua"))()
local InterfaceManager = loadstring(game:HttpGet("https://raw.githubusercontent.com/dawid-scripts/Fluent/master/Addons/InterfaceManager.lua"))()

local Window = NovaHub:CreateWindow({
    Title = "Muscle Legend Private Script" .. Fluent.Version,
    SubTitle = "by Encrypted",
    TabWidth = 160,
    Size = UDim2.fromOffset(580, 400),
    Acrylic = true,
    Theme = "NovaHub",
    MinimizeKey = Enum.KeyCode.LeftControl
})

-- Create Tabs
local Tabs = {
    Main = Window:AddTab({ Title = "Main", Icon = "scan-face" }),
    AutoFarm = Window:AddTab({ Title = "Auto Farm", Icon = "biceps-flexed" }),
    Rebirth = Window:AddTab({ Title = "Rebirth", Icon = "Refresh" }),
    Stats = Window:AddTab({ Title = "Stats", Icon = "particles" }),
    Crystal = Window:AddTab({ Title = "Crystal", Icon = "gem" }),
    Killing = Window:AddTab({ Title = "Killing", Icon = "sword" }),
    Teleport = Window:AddTab({ Title = "Teleport", Icon = "asterisk" }),
    Misc = Window:AddTab({ Title = "Misc", Icon = "settings" })
}

-- **Main Tab**
Tabs.Main:AddParagraph({ Title = "Server Invite", Content = "" })
Tabs.Main:AddButton({
    Title = "Discord Server",
    Description = "Copy discord server link",
    Callback = function()
        setclipboard("https://discord.gg/ztGskBVU")
    end
})

-- **WalkSpeed Input**
local WalkSpeedInput = Tabs.Main:AddInput("WalkSpeed", {
    Title = "WalkSpeed",
    Default = "16",
    Placeholder = "Enter WalkSpeed",
    Numeric = true,
    Finished = true,
    Callback = function(Value) end
})

Tabs.Main:AddButton({
    Title = "Apply WalkSpeed",
    Callback = function()
        local walkSpeedValue = tonumber(WalkSpeedInput.Value)
        if walkSpeedValue then
            game.Players.LocalPlayer.Character.Humanoid.WalkSpeed = walkSpeedValue
        end
    end
})

-- **JumpPower Input**
local JumpPowerInput = Tabs.Main:AddInput("JumpPower", {
    Title = "JumpPower",
    Default = "50",
    Placeholder = "Enter JumpPower",
    Numeric = true,
    Finished = true,
    Callback = function(Value) end
})

Tabs.Main:AddButton({
    Title = "Apply JumpPower",
    Callback = function()
        local jumpPowerValue = tonumber(JumpPowerInput.Value)
        if jumpPowerValue then
            game.Players.LocalPlayer.Character.Humanoid.JumpPower = jumpPowerValue
        end
    end
})

-- **Auto Reps Toggle**
local autoReps = false
Tabs.AutoFarm:AddToggle("Auto Reps", { Title = "Auto Reps", Default = false }):OnChanged(function(state)
    autoReps = state
    while autoReps do
        game:GetService("Players").LocalPlayer:WaitForChild("muscleEvent"):FireServer("rep")
        task.wait(0.1)
    end
end)

-- Store toggle states
local toggleStates = {}

-- **Auto Equip Tool Function**
local function autoEquipTool(toolName, toggleName)
    local player = game.Players.LocalPlayer
    local backpack = player:FindFirstChild("Backpack")

    -- Update toggle state
    if not toggleStates[toggleName] then
        toggleStates[toggleName] = false
        return
    end

    -- Create a new task for auto-equipping
    task.spawn(function()
        while toggleStates[toggleName] do
            if backpack then
                local tool = backpack:FindFirstChild(toolName)
                if tool then
                    player.Character.Humanoid:EquipTool(tool)
                end
            end
            task.wait(0.1)
        end
    end)
end

Tabs.AutoFarm:AddParagraph({ Title = "Tools", Content = "" })

-- **Auto Equip Toggles**
Tabs.AutoFarm:AddToggle("Auto Equip Weight", { Title = "Auto Equip Weight", Default = false }):OnChanged(function(state)
    toggleStates["Auto Equip Weight"] = state
    autoEquipTool("Weight", "Auto Equip Weight")
end)

Tabs.AutoFarm:AddToggle("Auto Equip Pushups", { Title = "Auto Equip Pushups", Default = false }):OnChanged(function(state)
    toggleStates["Auto Equip Pushups"] = state
    autoEquipTool("Pushups", "Auto Equip Pushups")
end)

Tabs.AutoFarm:AddToggle("Auto Equip Situps", { Title = "Auto Equip Situps", Default = false }):OnChanged(function(state)
    toggleStates["Auto Equip Situps"] = state
    autoEquipTool("Sit-ups", "Auto Equip Situps")
end)

Tabs.AutoFarm:AddToggle("Auto Equip Handstands", { Title = "Auto Equip Handstands", Default = false }):OnChanged(function(state)
    toggleStates["Auto Equip Handstands"] = state
    autoEquipTool("Handstand", "Auto Equip Handstands")
end)


local autoRebirth = false
local rebirthUntilTarget = false
local targetRebirths = 0
local autoEatProteinEgg = false
local eatEveryProteinEggs = false

-- **Auto Rebirth Toggle**
Tabs.Rebirth:AddToggle("Auto Rebirth (Infinitely)", { Title = "Auto Rebirth (Infinitely)", Default = false }):OnChanged(function(state)
    autoRebirth = state
    if state then
        task.spawn(function()
            while autoRebirth do
                game:GetService("ReplicatedStorage"):WaitForChild("rEvents"):WaitForChild("rebirthRemote"):InvokeServer("rebirthRequest")
                task.wait(0.1)
            end
        end)
    end
end)

-- **Input Field for Target Rebirth Amount**
local Input = Tabs.Rebirth:AddInput("Select Rebirth Target", {
    Title = "Select Rebirth Target",
    Default = "0",
    Placeholder = "Enter Target Rebirths",
    Numeric = true, -- Only allows numbers
    Finished = true, -- Calls callback when you press enter
    Callback = function(Value)
        targetRebirths = tonumber(Value) or 0
        print("Target rebirths set to:", targetRebirths)
    end
})

-- **Rebirth Until Target Toggle**
Tabs.Rebirth:AddToggle("Rebirth Until Target Amount", { Title = "Rebirth Until Target Amount", Default = false }):OnChanged(function(state)
    rebirthUntilTarget = state
    if state then
        task.spawn(function()
            while rebirthUntilTarget do
                local player = game.Players.LocalPlayer
                local leaderstats = player:FindFirstChild("leaderstats")
                if leaderstats then
                    local currentRebirths = leaderstats:FindFirstChild("Rebirths")
                    if currentRebirths and currentRebirths.Value >= targetRebirths then
                        rebirthUntilTarget = false
                        print("Target rebirth amount reached!")
                        break
                    end
                    game:GetService("ReplicatedStorage"):WaitForChild("rEvents"):WaitForChild("rebirthRemote"):InvokeServer("rebirthRequest")
                end
                task.wait(0.1)
            end
        end)
    end
end)

-- **Auto Eat Protein Egg Every 30 Minutes**
Tabs.Rebirth:AddToggle("Auto Eat Protein Egg", { Title = "Auto Eat Protein Egg Every 30 Minutes", Default = false }):OnChanged(function(state)
    autoEatProteinEgg = state
    if state then
        task.spawn(function()
            local player = game.Players.LocalPlayer
            local backpack = player:FindFirstChild("Backpack")

            while autoEatProteinEgg do
                -- Equip & Use Protein Egg if found
                if backpack then
                    local tool = backpack:FindFirstChild("Protein Egg")
                    if tool then
                        player.Character.Humanoid:EquipTool(tool)
                        task.wait(0.5)
                        game:GetService("Players").LocalPlayer:WaitForChild("muscleEvent"):FireServer("rep")
                    end
                end

                -- Wait 30 minutes (1800 seconds)
                for i = 1, 1800 do
                    if not autoEatProteinEgg then break end
                    task.wait(1)
                end
            end
        end)
    end
end)

-- **Eat Every Protein Egg In Inventory**
Tabs.Rebirth:AddToggle("Eat Every Protein Eggs", { Title = "Eat Every Protein Eggs In Inventory", Default = false }):OnChanged(function(state)
    eatEveryProteinEggs = state
    if state then
        task.spawn(function()
            local player = game.Players.LocalPlayer
            local backpack = player:FindFirstChild("Backpack")

            while eatEveryProteinEggs do
                if backpack then
                    for _, tool in ipairs(backpack:GetChildren()) do
                        if tool:IsA("Tool") and tool.Name == "Protein Egg" then
                            player.Character.Humanoid:EquipTool(tool)
                            task.wait(0.5)
                            game:GetService("Players").LocalPlayer:WaitForChild("muscleEvent"):FireServer("rep")
                        end
                    end
                end
                task.wait(1) -- Small delay to prevent excessive loops
            end
        end)
    end
end)

local hideFrame = false

Tabs.Rebirth:AddToggle("Hide Frame", { Title = "Hide Frame", Default = false }):OnChanged(function(state)
    hideFrame = state
    local player = game.Players.LocalPlayer
    local playerGui = player:FindFirstChild("PlayerGui")

    if playerGui then
        local gameGui = playerGui:FindFirstChild("gameGui")
        if gameGui then
            local statsMenu = gameGui:FindFirstChild("statsMenu")
            if statsMenu then
                for _, child in ipairs(statsMenu:GetChildren()) do
                    if child:IsA("GuiObject") then
                        child.Visible = not hideFrame -- Hide when toggle is ON, Show when OFF
                    end
                end
            end
        end
    end
end)

-- Time Since Script Executed Paragraph
local TimeSinceExecutedParagraph = Tabs.Stats:AddParagraph({
    Title = "Time Since Script Executed",
    Content = "Hours: 0 Minutes: 0 Seconds: 0"
})

-- Select Target Dropdown
local Dropdown = Tabs.Stats:AddDropdown("Select Target", {
    Title = "Select Target",
    Values = {},  -- Start with an empty list
    Multi = false,
    Default = 1,
})

-- Target Stats Paragraph
local TargetStatsParagraph = Tabs.Stats:AddParagraph({
    Title = "Target Stats",
    Content = "Amount Of Strength: 0\nAmount Of Durability: 0\nAmount Of Agility: 0\nAmount Of Kills: 0",
})

-- Your Stats Paragraph
local YourStatsParagraph = Tabs.Stats:AddParagraph({
    Title = "Your Stats",
    Content = "Amount Of Strength: 0\nAmount Of Durability: 0\nAmount Of Agility: 0\nAmount Of Kills: 0",
})

-- Function to abbreviate numbers for readability (K = Thousand, M = Million, B = Billion, QA = Quadrillion, T = Trillion)
local function abbreviateNumber(number)
    if number >= 1e15 then
        return string.format("%.1fQA", number / 1e15)  -- Quadrillion
    elseif number >= 1e12 then
        return string.format("%.1fT", number / 1e12)  -- Trillion
    elseif number >= 1e9 then
        return string.format("%.1fB", number / 1e9)   -- Billion
    elseif number >= 1e6 then
        return string.format("%.1fM", number / 1e6)   -- Million
    elseif number >= 1e3 then
        return string.format("%.1fK", number / 1e3)   -- Thousand
    else
        return tostring(number)  -- No abbreviation
    end
end

-- Update the "Your Stats" paragraph every 0.1 second
game:GetService("RunService").Heartbeat:Connect(function()
    local player = game.Players.LocalPlayer
    local leaderstats = player:FindFirstChild("leaderstats")
    local strength = leaderstats and leaderstats.Strength and leaderstats.Strength.Value or 0
    local durability = player:FindFirstChild("Durability") and player.Durability.Value or 0
    local agility = player:FindFirstChild("Agility") and player.Agility.Value or 0
    local kills = leaderstats and leaderstats.Kills and leaderstats.Kills.Value or 0

    -- Update the paragraph with your current stats using SetDesc
    if YourStatsParagraph then
        YourStatsParagraph:SetDesc(string.format([[
            Amount Of Strength: %s
            Amount Of Durability: %s
            Amount Of Agility: %s
            Amount Of Kills: %s
        ]], abbreviateNumber(strength), abbreviateNumber(durability), abbreviateNumber(agility), abbreviateNumber(kills)))
    end
end)

-- Function to update the dropdown with player names
local function updateDropdown()
    local playerNames = {}
    for _, player in ipairs(game.Players:GetPlayers()) do
        table.insert(playerNames, player.Name)
    end

    -- Safely set values if the dropdown allows it
    if Dropdown and Dropdown.SetValues then
        Dropdown:SetValues(playerNames)
    else
        warn("Dropdown:SetValues method not available")
    end

    -- Set the default to the first player in the list (if any)
    if #playerNames > 0 then
        Dropdown:SetValue(playerNames[1])  -- Update the value
    else
        Dropdown:SetValue("")  -- No players in game
    end
end

-- Call updateDropdown whenever players join/leave
game.Players.PlayerAdded:Connect(updateDropdown)
game.Players.PlayerRemoving:Connect(updateDropdown)

-- Handle dropdown changes
Dropdown:OnChanged(function(selectedPlayerName)
    -- Find the selected player
    local selectedPlayer = game.Players:FindFirstChild(selectedPlayerName)
    if selectedPlayer then
        -- Retrieve the player's leaderstats
        local leaderstats = selectedPlayer:FindFirstChild("leaderstats")
        local strength = leaderstats and leaderstats.Strength and leaderstats.Strength.Value or 0
        local durability = selectedPlayer:FindFirstChild("Durability") and selectedPlayer.Durability.Value or 0
        local agility = selectedPlayer:FindFirstChild("Agility") and selectedPlayer.Agility.Value or 0
        local kills = leaderstats and leaderstats.Kills and leaderstats.Kills.Value or 0

        -- Safely update the paragraph with the player's stats using SetDesc
        if TargetStatsParagraph then
            TargetStatsParagraph:SetDesc(string.format([[
                Amount Of Strength: %s
                Amount Of Durability: %s
                Amount Of Agility: %s
                Amount Of Kills: %s
            ]], abbreviateNumber(strength), abbreviateNumber(durability), abbreviateNumber(agility), abbreviateNumber(kills)))
        end
    else
        -- If player doesn't exist, set stats to 0
        if TargetStatsParagraph then
            TargetStatsParagraph:SetDesc("Amount Of Strength: 0\nAmount Of Durability: 0\nAmount Of Agility: 0\nAmount Of Kills: 0")
        end
    end
end)

-- Initial population of the dropdown when the script runs
updateDropdown()

-- Timer for Stats Tab
local startTime = tick() -- Store the time when the script starts executing

-- Function to convert total seconds into hours, minutes, and seconds
local function convertTime(seconds)
    local hours = math.floor(seconds / 3600)
    seconds = seconds - hours * 3600
    local minutes = math.floor(seconds / 60)
    seconds = seconds - minutes * 60
    return hours, minutes, seconds
end

-- Function to update the time since script execution
local function updateTimeSinceExecuted()
    local elapsedTime = tick() - startTime
    local hours, minutes, seconds = convertTime(elapsedTime)

    -- Update the Time Since Script Executed paragraph content
    if TimeSinceExecutedParagraph then
        TimeSinceExecutedParagraph:SetDesc(string.format(
            "Hours: %d Minutes: %d Seconds: %d",
            hours, minutes, seconds
        ))
    end
end

-- Continuously update the time since script execution every second
while true do
    updateTimeSinceExecuted()
    wait(1)  -- Update every second
end
